<app-display-message-box #displayMessageBox></app-display-message-box>
<app-display-message-box #messageBox></app-display-message-box>
<app-loader-infinite-spinner
  [show]="startLoading"
></app-loader-infinite-spinner>

<div #rootElement class="px-6 py-2 w-full flex flex-col space-y-2">
  <div class="flex flex-row items-center justify-between">
    <h2
      *transloco="let t; read: 'reports.transactionDetails'"
      class="text-lg font-bold"
    >
      {{ t("transaction") }}
    </h2>
    <div class="flex flex-row items-center space-x-2">
      <a
        (click)="downloadPdf(payments)"
        class="flex flex-row items-center btn btn-sm border border-success btn-ghost"
      >
        <span>
          <i class="bi bi-download text-success text-lg"></i>
        </span>
      </a>
    </div>
  </div>
  <div id="accordionExample">
    <div
      *ngFor="
        let payment of payments;
        index as i;
        trackBy: PerformanceUtils.trackByIndex
      "
      class="rounded-t-lg border border-neutral-200 bg-white"
    >
      <h2 class="mb-0" [id]="'heading-' + i.toString()">
        <button
          class="group relative flex w-full items-center rounded-t-[15px] border-0 bg-white px-5 py-4 text-left text-base text-neutral-800 transition [overflow-anchor:none] hover:z-[2] focus:z-[3] focus:outline-none [&:not([data-te-collapse-collapsed])]:bg-white [&:not([data-te-collapse-collapsed])]:text-black [&:not([data-te-collapse-collapsed])]:font-extrabold [&:not([data-te-collapse-collapsed])]:[box-shadow:inset_0_-1px_0_rgba(229,231,235)]"
          type="button"
          data-te-collapse-init
          [attr.data-te-target]="'#' + 'collapse-' + i.toString()"
          [attr.aria-expanded]="false"
          [attr.aria-controls]="'collapse-' + i.toString()"
        >
          <h1
            *transloco="let t; read: 'reports.transactionDetails'"
            class="text-xl"
          >
            {{ payment.Payment_Trans_No }}
          </h1>
          <span
            class="material-symbols-outlined -mr-1 ml-auto h-5 w-5 shrink-0 rotate-[-180deg] fill-[#336dec] transition-transform duration-200 ease-in-out group-[[data-te-collapse-collapsed]]:mr-0 group-[[data-te-collapse-collapsed]]:rotate-0 group-[[data-te-collapse-collapsed]]:fill-[#212529] motion-reduce:transition-none"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              height="24"
              viewBox="0 -960 960 960"
              width="24"
            >
              <path d="M480-345 240-585l56-56 184 184 184-184 56 56-240 240Z" />
            </svg>
          </span>
        </button>
      </h2>
      <div
        [id]="'collapse-' + i.toString()"
        class="!visible"
        data-te-collapse-item
        data-te-collapse-show
        [attr.aria-labelledby]="'heading-' + i.toString()"
        data-te-parent="#accordionExample"
      >
        <div
          class="px-5 py-4 grid grid-cols-3 lg:grid-cols-5 w-full gap-y-4 gap-x-3"
        >
          <div class="flex flex-col">
            <p
              *transloco="let t; read: 'reports.transactionDetails'"
              class="text-neutral-500 text-xs uppercase"
            >
              {{ t("company") }}
            </p>
            <p class="text-black text-sm capitalize font-semibold">
              {{ payment.Company_Name }}
            </p>
          </div>
          <div class="flex flex-col">
            <p
              *transloco="let t; read: 'reports.transactionDetails'"
              class="text-neutral-500 text-xs uppercase"
            >
              {{ t("customer") }}
            </p>
            <p class="text-black text-sm capitalize font-semibold">
              {{ payment.Customer_Name }}
            </p>
          </div>
          <div class="flex flex-col">
            <p
              *transloco="let t; read: 'reports.transactionDetails'"
              class="text-neutral-500 text-xs uppercase"
            >
              {{ t("description") }}
            </p>
            <p class="text-black text-sm capitalize font-semibold">
              {{ payment.Payment_Desc }}
            </p>
          </div>
          <div class="flex flex-col">
            <p
              *transloco="let t; read: 'reports.transactionDetails'"
              class="text-neutral-500 text-xs uppercase"
            >
              {{ t("transactionType") }}
            </p>
            <button
              class="lg:w-1/2"
              [class]="
                PerformanceUtils.getActiveStatusStyles(
                  payment.Payment_Type,
                  'Fixed',
                  'bg-purple-100',
                  'text-black',
                  'bg-teal-100',
                  'text-black'
                )
              "
            >
              {{ payment.Payment_Type }}
            </button>
          </div>
          <div class="flex flex-col">
            <p
              *transloco="let t; read: 'reports.transactionDetails'"
              class="text-neutral-500 text-xs uppercase"
            >
              {{ t("amount") }}
            </p>
            <p class="text-black text-sm capitalize font-semibold">
              {{ moneyFormat(payment.PaidAmount.toString()) }}
            </p>
          </div>
          <div class="flex flex-col">
            <p
              *transloco="let t; read: 'reports.transactionDetails'"
              class="text-neutral-500 text-xs uppercase"
            >
              {{ t("currency") }}
            </p>
            <p class="text-black text-sm capitalize font-semibold">
              {{ payment.Currency_Code }}
            </p>
          </div>
          <div class="flex flex-col">
            <p
              *transloco="let t; read: 'reports.transactionDetails'"
              class="text-neutral-500 text-xs uppercase"
            >
              {{ t("payer") }}
            </p>
            <p class="text-black text-sm capitalize font-semibold">
              {{ payment.Payer_Name }}
            </p>
          </div>
          <div class="flex flex-col">
            <p
              *transloco="let t; read: 'reports.transactionDetails'"
              class="text-neutral-500 text-xs uppercase"
            >
              {{ t("method") }}
            </p>
            <p class="text-black text-sm capitalize font-semibold">
              {{ payment.Trans_Channel }}
            </p>
          </div>
          <div class="flex flex-col">
            <p
              *transloco="let t; read: 'reports.transactionDetails'"
              class="text-neutral-500 text-xs uppercase"
            >
              {{ t("balance") }}
            </p>
            <p class="text-black text-sm capitalize font-semibold">
              {{ PerformanceUtils.moneyFormat(payment.Balance.toString()) }}
            </p>
          </div>
          <div class="flex flex-col">
            <p
              *transloco="let t; read: 'reports.transactionDetails'"
              class="text-neutral-500 text-xs uppercase"
            >
              {{ t("status") }}
            </p>
            <button class="flex flex-row items-center space-x-0.5">
              <div class="w-2 h-2 rounded-full bg-success"></div>
              <p class="text-success text-sm">{{ payment.Status }}</p>
            </button>
          </div>
          <div class="flex flex-col col-span-full space-y-2">
            <p
              *transloco="let t; read: 'reports.transactionDetails'"
              class="text-neutral-500 text-xs uppercase col-span-full"
            >
              {{ t("attachment") }}
            </p>
            <div
              class="flex flex-row items-center justify-between space-x-4 border border-neutral-500 max-w-full lg:max-w-fit p-2"
            >
              <div class="flex flex-col">
                <p class="text-sm font-semibold">{{ payment.Receipt_No }}</p>
                <p class="text-sm">
                  {{
                    PerformanceUtils.convertDateStringToDate(
                      payment.Payment_Date
                    ).toLocaleDateString()
                  }}
                  {{
                    PerformanceUtils.convertDateStringToDate(
                      payment.Payment_Time
                    ).toLocaleTimeString()
                  }}
                </p>
              </div>
              <div class="flex flex-row items-center space-x-1">
                <button
                  (click)="openReceipt(payment)"
                  *transloco="let t; read: 'actions'"
                  class="btn btn-sm bg-transparent tooltip lg:block hidden"
                  [attr.data-tip]="t('view')"
                >
                  <span>
                    <i class="bi bi-eye text-lg text-warning"></i>
                  </span>
                </button>
                <button
                  (click)="downloadReceipt(payment)"
                  *transloco="let t; read: 'actions'"
                  class="btn btn-sm bg-transparent tooltip"
                  [attr.data-tip]="t('download')"
                >
                  <span>
                    <i class="bi bi-download text-lg text-purple-600"></i>
                  </span>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="border border-t-0 border-neutral-200 bg-white hidden">
      <h2 class="mb-0" id="headingTwo">
        <button
          class="group relative flex w-full items-center rounded-none border-0 bg-white px-5 py-4 text-left text-base text-neutral-800 transition [overflow-anchor:none] hover:z-[2] focus:z-[3] focus:outline-none [&:not([data-te-collapse-collapsed])]:bg-white [&:not([data-te-collapse-collapsed])]:text-black [&:not([data-te-collapse-collapsed])]:font-extrabold [&:not([data-te-collapse-collapsed])]:[box-shadow:inset_0_-1px_0_rgba(229,231,235)]"
          type="button"
          data-te-collapse-init
          data-te-collapse-collapsed
          data-te-target="#collapseTwo"
          [attr.aria-expanded]="false"
          aria-controls="collapseTwo"
        >
          <h1
            *transloco="
              let t;
              read: 'reports.transactionDetails.approvalDetails'
            "
            class="text-2xl"
          >
            {{ t("approvalDetails") }}
          </h1>
          <span
            class="material-symbols-outlined -mr-1 ml-auto h-5 w-5 shrink-0 rotate-[-180deg] fill-[#336dec] transition-transform duration-200 ease-in-out group-[[data-te-collapse-collapsed]]:mr-0 group-[[data-te-collapse-collapsed]]:rotate-0 group-[[data-te-collapse-collapsed]]:fill-[#212529] motion-reduce:transition-none"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              height="24"
              viewBox="0 -960 960 960"
              width="24"
            >
              <path d="M480-345 240-585l56-56 184 184 184-184 56 56-240 240Z" />
            </svg>
          </span>
        </button>
      </h2>
    </div>
  </div>
</div>
